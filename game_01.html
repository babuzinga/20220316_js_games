<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <style>
    * { padding: 0; margin: 0; }
    body, html { background-color: black; color: white; }
    div { padding: 2px; text-align: center; }
    canvas { display: block; margin: 20px auto 0; background-color: white; }
  </style>
</head>
<body>
<div id="log">1</div>
<div id="myData">1</div>
<canvas id="myCanvas" width="600" height="600"></canvas>

<script>
  let world = {
    ff: 1,
    f: function () {
      return this.ff();
    }
  };



  let canvas = document.getElementById("myCanvas"),
      log = document.getElementById("log"),
      myData = document.getElementById("myData"),
      ctx = canvas.getContext("2d"),
      maps_x = 500,     // размер карты
      maps_y = 500,
      maps = [],  // карта
      maps_x_gamer = 0, // положение игрока на карте
      maps_y_gamer = 0,
      map_offset_x = 0, // сдвиг карты в окне
      map_offset_y = 0,
      map_borders = 5,
      item_width = item_height = 30,  // размер элемента на карте (30)
      canvas_item_x = canvas.width / item_width,    // макс. кол-во элементво карты в окне
      canvas_item_y = canvas.height / item_height,
      item_offset_top = item_offset_left = 0, // сдвиг элемент при отрисовке (квадрат)
      item_padding = 0, // отступы
      item_x, // координаты элемента карты при отрисовке в окне
      item_y,
      subjects = [],  // набор объктов в карте
      subject,
      gamer_x = gamer_y = 0, // координаты игрока в окне
      i, map_i,
      j, map_j,
      f_style,
      right_pressed,  // состояние кнопок управления
      left_pressed,
      up_pressed,
      down_pressed
  ;

  log.innerText = 'canvas_item_x : ' + canvas_item_x + ' | canvas_item_y : ' + canvas_item_y;
  document.addEventListener("keydown", keyDownHandler, false);
  document.addEventListener("keyup", keyUpHandler, false);

  function keyDownHandler(e) {
    if (e.code == 'ArrowRight' || e.code == 'KeyD') {
      right_pressed = true;
    } else if (e.code == 'ArrowLeft' || e.code == 'KeyA') {
      left_pressed = true;
    } else if (e.code == 'ArrowUp' || e.code == 'KeyW') {
      up_pressed = true;
    } else if (e.code == 'ArrowDown' || e.code == 'KeyS') {
      down_pressed = true;
    }
  }

  function keyUpHandler(e) {
    if (e.code == 'ArrowRight' || e.code == 'KeyD') {
      right_pressed = false;
    } else if (e.code == 'ArrowLeft' || e.code == 'KeyA') {
      left_pressed = false;
    } else if (e.code == 'ArrowUp' || e.code == 'KeyW') {
      up_pressed = false;
    } else if (e.code == 'ArrowDown' || e.code == 'KeyS') {
      down_pressed = false;
    }
  }



  /**
   * Генерирование карты
   * виды поверхностей: зелень : песок : вода
   */
  let surfaces_background = ['#8dfc8d', '#74ee74', '#6fe36f'];


  function generateMaps() {
    for(i = 0; i < maps_y; i++) {
      maps[i] = [];
      for(j = 0; j < maps_x; j++) {
        maps[i][j] = {
          status:           1,
          type:             1,
          type_background:  surfaces_background[Math.floor(Math.random() * surfaces_background.length)],
          destruction:      0,
          item:             1
        };
      }
    }
  }

  /**
   * Отрисовка карты
   */
  function drawMaps() {
    for(i = 0; i < canvas_item_y; i++) {
      for(j = 0; j < canvas_item_x; j++) {
        item_x = (j * (item_width + item_padding)) + item_offset_left;
        item_y = (i * (item_height + item_padding)) + item_offset_top;
        f_style = 'white';

        map_i = i + (map_offset_y * -1);
        map_j = j + (map_offset_x * -1);

        if(maps[map_i] && maps[map_i][map_j] && maps[map_i][map_j].status === 1) {
          subject = maps[map_i][map_j];
          f_style = subject.type_background;
        }

        ctx.beginPath();
        ctx.rect(item_x, item_y, item_width, item_height);
        ctx.fillStyle = f_style;
        ctx.fill();

        // Затемнение
        //ctx.fillStyle = "rgba(0, 0, 0, 0.95)";
        //ctx.fill();

        // Обводка
        //ctx.strokeStyle = "rgba(0, 0, 0, 0.1)";
        //ctx.stroke();

        ctx.closePath();
      }
    }
  }

  function drawGamer() {
    myData.innerText = gamer_x + ':' + gamer_y +
        ' [' + maps_x_gamer + ':' + maps_y_gamer + ']' +
        ' [' + map_offset_x + ':' + map_offset_y + ']'
    ;

    ctx.beginPath();
    ctx.rect(gamer_x * item_width, gamer_y * item_width, item_width, item_height);
    ctx.fillStyle = "#000000";
    ctx.fill();
    ctx.closePath();
  }



  function draw() {
    // Очистка объекта canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    maps_x_gamer = gamer_x + (map_offset_x * -1);
    maps_y_gamer = gamer_y + (map_offset_y * -1);

    // Передвижение по X
    if (right_pressed) {
      if (gamer_x === canvas_item_x - 1 - map_borders && maps_x + map_offset_x > canvas_item_x) map_offset_x -= 1;
      else if (gamer_x < canvas_item_x - 1 && gamer_x < maps_x - 1) gamer_x += 1;
      else if (gamer_x >= canvas_item_x - 1 && maps_x_gamer < maps_x - 1) map_offset_x -= 1;
    }

    if (left_pressed) {
      if (gamer_x === map_borders && map_offset_x < 0) map_offset_x += 1;
      else if (gamer_x > 0 && maps_x_gamer < maps_x) gamer_x -= 1;
      else if (gamer_x === 0 && map_offset_x < 0) map_offset_x += 1;
    }

    if (down_pressed) {
      if (gamer_y === canvas_item_y - 1 - map_borders && maps_y + map_offset_y > canvas_item_y) map_offset_y -= 1;
      else if (gamer_y < canvas_item_y - 1 && gamer_y < maps_y - 1) gamer_y += 1;
      else if (gamer_y >= canvas_item_y - 1 && maps_y_gamer < maps_y - 1) map_offset_y -= 1;
    }

    if (up_pressed) {
      if (gamer_y === map_borders && map_offset_y < 0) map_offset_y += 1;
      else if (gamer_y > 0 && maps_y_gamer < maps_y) gamer_y -= 1;
      else if (gamer_y === 0 && map_offset_y < 0) map_offset_y += 1;
    }





    drawMaps();
    drawGamer();

    // requestAnimationFrame(draw);
    // clearInterval(interval); // Needed for Chrome to end game
  }

  generateMaps();
  //draw();
  let interval = setInterval(draw, 50);
</script>
</body>
</html>